<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GESER G & TAMBAH G ANGKABET167</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary: #FFD700;
            --secondary: #1A1A1A;
            --accent: #FF6B00;
            --text: #FFFFFF;
            --text-secondary: #CCCCCC;
            --card-bg: #2A2A2A;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --info: #17A2B8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--secondary);
            color: var(--text);
            overflow-x: hidden;
            position: relative;
        }

        /* Star animations */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .star {
            position: absolute;
            background-color: var(--primary);
            border-radius: 50%;
            animation: twinkle var(--duration) infinite ease-in-out;
        }

        .falling-star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: linear-gradient(to right, rgba(255,215,0,0.1), var(--primary));
            border-radius: 50%;
            animation: fall var(--fall-duration) linear infinite;
            transform: rotate(45deg);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(45deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(45deg);
                opacity: 0;
            }
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .logo-container {
            display: flex;
            align-items: center;
        }

        .logo {
            height: 50px;
            margin-right: 15px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--secondary);
            font-weight: bold;
        }

        .user-name {
            font-weight: 500;
            margin-right: 15px;
        }

        .logout-btn {
            background-color: var(--danger);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background-color: var(--card-bg);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .nav-tab {
            padding: 15px 25px;
            cursor: pointer;
            text-align: center;
            flex: 1;
            transition: all 0.3s;
            position: relative;
        }

        .nav-tab:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .nav-tab.active {
            background-color: var(--primary);
            color: var(--secondary);
            font-weight: 600;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid var(--primary);
        }

        .tab-badge {
            background-color: var(--accent);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-left: 5px;
        }

        /* Main content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Cards */
        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--secondary);
        }

        .btn-primary:hover {
            background-color: #e6c200;
        }

        .btn-secondary {
            background-color: var(--accent);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #e05d00;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background-color: rgba(255, 255, 255, 0.05);
            color: var(--text);
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.3);
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-col {
            flex: 1;
        }

        /* Tables */
        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .table th, .table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .table th {
            background-color: rgba(255, 215, 0, 0.1);
            color: var(--primary);
            font-weight: 600;
        }

        .table tr:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-online {
            background-color: rgba(40, 167, 69, 0.2);
            color: var(--success);
        }

        .status-offline {
            background-color: rgba(220, 53, 69, 0.2);
            color: var(--danger);
        }

        .status-pending {
            background-color: rgba(255, 193, 7, 0.2);
            color: var(--warning);
        }

        /* Login page */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--secondary);
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 40px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to right, var(--primary), var(--accent));
        }

        .login-logo {
            height: 70px;
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 24px;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--danger);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-btn:hover {
            background-color: #c82333;
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background-color: rgba(40, 167, 69, 0.2);
            border-left: 4px solid var(--success);
            color: var(--success);
        }

        .alert-danger {
            background-color: rgba(220, 53, 69, 0.2);
            border-left: 4px solid var(--danger);
            color: var(--danger);
        }

        .alert-warning {
            background-color: rgba(255, 193, 7, 0.2);
            border-left: 4px solid var(--warning);
            color: var(--warning);
        }

        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .nav-tab {
                padding: 12px;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-info {
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e6c200;
        }

        /* Animation classes */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        /* Grid layout */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Bank icons */
        .bank-icon {
            width: 30px;
            height: 30px;
            object-fit: contain;
            margin-right: 10px;
            vertical-align: middle;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: var(--primary);
        }

        .timeline-item {
            position: relative;
            padding-bottom: 20px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -30px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--primary);
            border: 2px solid var(--secondary);
        }

        .timeline-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .timeline-content {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <!-- Star background -->
    <div class="stars" id="stars"></div>

    <!-- Login Page -->
    <div id="login-page" class="login-container">
        <div class="login-card">
            <img src="https://angkabet026.com/resources/images/logo.png" alt="Logo" class="login-logo">
            <h1 class="login-title">GESER G & TAMBAH G ANGKABET167</h1>
            <div id="login-error" class="alert alert-danger" style="display: none;"></div>
            <button id="google-login" class="login-btn">
                <i class="fab fa-google"></i> Login with Google
            </button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display: none;">
        <div class="container">
            <!-- Header -->
            <header class="header">
                <div class="logo-container">
                    <img src="https://angkabet026.com/resources/images/logo.png" alt="Logo" class="logo">
                    <span class="logo-text">GESER G & TAMBAH G ANGKABET167</span>
                </div>
                <div class="user-info">
                    <span class="user-name" id="user-name">User</span>
                    <div class="user-avatar" id="user-avatar">U</div>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>

            <!-- Navigation Tabs -->
            <nav class="nav-tabs">
                <div class="nav-tab active" data-tab="dashboard-tab">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </div>
                <div class="nav-tab" data-tab="geser-tab">
                    <i class="fas fa-exchange-alt"></i> Geser G
                </div>
                <div class="nav-tab" data-tab="tambah-tab">
                    <i class="fas fa-plus-circle"></i> Tambah G
                </div>
                <div class="nav-tab" data-tab="waiting-tab">
                    <i class="fas fa-clock"></i> Waiting <span class="tab-badge" id="waiting-badge">0</span>
                </div>
                <div class="nav-tab" data-tab="history-tab">
                    <i class="fas fa-history"></i> History
                </div>
                <div class="nav-tab" data-tab="accounts-tab">
                    <i class="fas fa-university"></i> Data Rekening
                </div>
                <div class="nav-tab" data-tab="groups-tab">
                    <i class="fas fa-users"></i> Grup Bank
                </div>
                <div class="nav-tab" data-tab="logs-tab">
                    <i class="fas fa-clipboard-list"></i> Log Aktivitas
                </div>
            </nav>

            <!-- Tab Contents -->
            <div class="tab-content active" id="dashboard-tab">
                <div class="grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Statistik Hari Ini</h3>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Jenis</th>
                                            <th>Jumlah</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Geser G</td>
                                            <td id="geser-today">0</td>
                                        </tr>
                                        <tr>
                                            <td>Tambah G</td>
                                            <td id="tambah-today">0</td>
                                        </tr>
                                        <tr>
                                            <td>Waiting Approval</td>
                                            <td id="waiting-today">0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Aktivitas Terakhir</h3>
                            <div class="card-actions">
                                <button class="btn btn-secondary" id="refresh-activity">
                                    <i class="fas fa-sync-alt"></i> Refresh
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="timeline" id="recent-activity">
                                <!-- Recent activity will be loaded here -->
                                <div class="timeline-item">
                                    <div class="timeline-date">Loading...</div>
                                    <div class="timeline-content">
                                        <div class="spinner"></div> Memuat aktivitas...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Pengguna Online</h3>
                        </div>
                        <div class="card-body">
                            <div id="online-users">
                                <div class="spinner"></div> Memuat daftar pengguna...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Geser G Tab -->
            <div class="tab-content" id="geser-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Form Geser G</h3>
                    </div>
                    <div class="card-body">
                        <div id="geser-error" class="alert alert-danger" style="display: none;"></div>
                        <div id="geser-success" class="alert alert-success" style="display: none;"></div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <h4>Rekening Lama</h4>
                                <div class="form-group">
                                    <label class="form-label">Nama Bank/E-Wallet</label>
                                    <select class="form-control" id="geser-bank-lama">
                                        <option value="">Pilih Bank/E-Wallet</option>
                                        <option value="SEABANK">SEABANK</option>
                                        <option value="JAGO">JAGO</option>
                                        <option value="OVO">OVO</option>
                                        <option value="LINKAJA">LINKAJA</option>
                                        <option value="GOPAY">GOPAY</option>
                                        <option value="MAYBANK">MAYBANK</option>
                                        <option value="BSI">BSI</option>
                                        <option value="DANAMON">DANAMON</option>
                                        <option value="CIMB">CIMB</option>
                                        <option value="MANDIRI">MANDIRI</option>
                                        <option value="BRI">BRI</option>
                                        <option value="DANA">DANA</option>
                                        <option value="BNI">BNI</option>
                                        <option value="BCA">BCA</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nama Rekening</label>
                                    <input type="text" class="form-control" id="geser-nama-lama" placeholder="Nama pemilik rekening">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nomor Rekening</label>
                                    <input type="text" class="form-control" id="geser-nomor-lama" placeholder="Nomor rekening">
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <h4>Rekening Baru</h4>
                                <div class="form-group">
                                    <label class="form-label">Nama Bank/E-Wallet</label>
                                    <select class="form-control" id="geser-bank-baru">
                                        <option value="">Pilih Bank/E-Wallet</option>
                                        <option value="SEABANK">SEABANK</option>
                                        <option value="JAGO">JAGO</option>
                                        <option value="OVO">OVO</option>
                                        <option value="LINKAJA">LINKAJA</option>
                                        <option value="GOPAY">GOPAY</option>
                                        <option value="MAYBANK">MAYBANK</option>
                                        <option value="BSI">BSI</option>
                                        <option value="DANAMON">DANAMON</option>
                                        <option value="CIMB">CIMB</option>
                                        <option value="MANDIRI">MANDIRI</option>
                                        <option value="BRI">BRI</option>
                                        <option value="DANA">DANA</option>
                                        <option value="BNI">BNI</option>
                                        <option value="BCA">BCA</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nama Rekening</label>
                                    <input type="text" class="form-control" id="geser-nama-baru" placeholder="Nama pemilik rekening">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Nomor Rekening</label>
                                    <input type="text" class="form-control" id="geser-nomor-baru" placeholder="Nomor rekening">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group" style="text-align: right; margin-top: 20px;">
                            <button class="btn btn-primary" id="submit-geser">
                                <i class="fas fa-check"></i> Konfirmasi Geser G
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tambah G Tab -->
            <div class="tab-content" id="tambah-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Form Tambah G</h3>
                    </div>
                    <div class="card-body">
                        <div id="tambah-error" class="alert alert-danger" style="display: none;"></div>
                        <div id="tambah-success" class="alert alert-success" style="display: none;"></div>
                        
                        <div class="form-group">
                            <label class="form-label">Nama Bank/E-Wallet</label>
                            <select class="form-control" id="tambah-bank">
                                <option value="">Pilih Bank/E-Wallet</option>
                                <option value="SEABANK">SEABANK</option>
                                <option value="JAGO">JAGO</option>
                                <option value="OVO">OVO</option>
                                <option value="LINKAJA">LINKAJA</option>
                                <option value="GOPAY">GOPAY</option>
                                <option value="MAYBANK">MAYBANK</option>
                                <option value="BSI">BSI</option>
                                <option value="DANAMON">DANAMON</option>
                                <option value="CIMB">CIMB</option>
                                <option value="MANDIRI">MANDIRI</option>
                                <option value="BRI">BRI</option>
                                <option value="DANA">DANA</option>
                                <option value="BNI">BNI</option>
                                <option value="BCA">BCA</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nama Rekening</label>
                            <input type="text" class="form-control" id="tambah-nama" placeholder="Nama pemilik rekening">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nomor Rekening</label>
                            <input type="text" class="form-control" id="tambah-nomor" placeholder="Nomor rekening">
                        </div>
                        
                        <div class="form-group" style="text-align: right; margin-top: 20px;">
                            <button class="btn btn-primary" id="submit-tambah">
                                <i class="fas fa-check"></i> Konfirmasi Tambah G
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Waiting Tab -->
            <div class="tab-content" id="waiting-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Daftar Waiting Approval</h3>
                        <div class="card-actions">
                            <button class="btn btn-secondary" id="refresh-waiting">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Jenis</th>
                                        <th>Detail</th>
                                        <th>Status</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="waiting-list">
                                    <tr>
                                        <td colspan="5" style="text-align: center;">
                                            <div class="spinner"></div> Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div class="tab-content" id="history-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">History Transaksi</h3>
                        <div class="card-actions">
                            <select class="form-control" id="history-filter" style="width: 150px;">
                                <option value="today">Hari Ini</option>
                                <option value="yesterday">Kemarin</option>
                                <option value="week">Minggu Ini</option>
                                <option value="month">Bulan Ini</option>
                                <option value="all">Semua</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Tanggal</th>
                                        <th>Jenis</th>
                                        <th>Detail</th>
                                        <th>Status</th>
                                        <th>Disetujui Oleh</th>
                                    </tr>
                                </thead>
                                <tbody id="history-list">
                                    <tr>
                                        <td colspan="5" style="text-align: center;">
                                            <div class="spinner"></div> Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accounts Tab -->
            <div class="tab-content" id="accounts-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Data Rekening Bank/E-Wallet</h3>
                        <div class="card-actions">
                            <button class="btn btn-primary" id="add-account-btn">
                                <i class="fas fa-plus"></i> Tambah Rekening
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Bank/E-Wallet</th>
                                        <th>Nama Rekening</th>
                                        <th>Nomor Rekening</th>
                                        <th>Status</th>
                                        <th>Grup</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="accounts-list">
                                    <tr>
                                        <td colspan="6" style="text-align: center;">
                                            <div class="spinner"></div> Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Groups Tab -->
            <div class="tab-content" id="groups-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Cek Grup Bank</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Pilih Bank/E-Wallet</label>
                            <select class="form-control" id="group-bank">
                                <option value="">Pilih Bank/E-Wallet</option>
                                <option value="SEABANK">SEABANK</option>
                                <option value="JAGO">JAGO</option>
                                <option value="OVO">OVO</option>
                                <option value="LINKAJA">LINKAJA</option>
                                <option value="GOPAY">GOPAY</option>
                                <option value="MAYBANK">MAYBANK</option>
                                <option value="BSI">BSI</option>
                                <option value="DANAMON">DANAMON</option>
                                <option value="CIMB">CIMB</option>
                                <option value="MANDIRI">MANDIRI</option>
                                <option value="BRI">BRI</option>
                                <option value="DANA">DANA</option>
                                <option value="BNI">BNI</option>
                                <option value="BCA">BCA</option>
                            </select>
                        </div>
                        <div class="form-group" style="text-align: right;">
                            <button class="btn btn-primary" id="check-group">
                                <i class="fas fa-search"></i> Cek Grup
                            </button>
                        </div>
                        
                        <div id="group-result" style="margin-top: 30px; display: none;">
                            <h4>Hasil Pengecekan Grup</h4>
                            <div class="alert alert-success" id="group-success" style="display: none;">
                                <i class="fas fa-check-circle"></i> Semua grup dari G1 sampai G20 lengkap dan tidak ada yang double.
                            </div>
                            <div class="alert alert-danger" id="group-error" style="display: none;">
                                <i class="fas fa-exclamation-circle"></i> Terdapat masalah pada grup berikut:
                            </div>
                            
                            <div class="table-responsive" style="margin-top: 20px;">
                                <table class="table" id="group-table">
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>Bank</th>
                                            <th>Nama Rekening</th>
                                            <th>Nomor Rekening</th>
                                            <th>Status</th>
                                            <th>Grup</th>
                                        </tr>
                                    </thead>
                                    <tbody id="group-list">
                                        <!-- Group data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div class="tab-content" id="logs-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Log Aktivitas</h3>
                        <div class="card-actions">
                            <button class="btn btn-secondary" id="refresh-logs">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Waktu</th>
                                        <th>User</th>
                                        <th>Aktivitas</th>
                                        <th>Detail</th>
                                    </tr>
                                </thead>
                                <tbody id="logs-list">
                                    <tr>
                                        <td colspan="4" style="text-align: center;">
                                            <div class="spinner"></div> Memuat data...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Account Modal -->
    <div id="add-account-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center;">
        <div class="card" style="width: 500px; max-width: 90%;">
            <div class="card-header">
                <h3 class="card-title">Tambah Rekening Baru</h3>
                <button id="close-add-account" style="background: none; border: none; color: var(--text); font-size: 20px; cursor: pointer;">&times;</button>
            </div>
            <div class="card-body">
                <div id="add-account-error" class="alert alert-danger" style="display: none;"></div>
                
                <div class="form-group">
                    <label class="form-label">Nama Bank/E-Wallet</label>
                    <select class="form-control" id="add-account-bank">
                        <option value="">Pilih Bank/E-Wallet</option>
                        <option value="SEABANK">SEABANK</option>
                        <option value="JAGO">JAGO</option>
                        <option value="OVO">OVO</option>
                        <option value="LINKAJA">LINKAJA</option>
                        <option value="GOPAY">GOPAY</option>
                        <option value="MAYBANK">MAYBANK</option>
                        <option value="BSI">BSI</option>
                        <option value="DANAMON">DANAMON</option>
                        <option value="CIMB">CIMB</option>
                        <option value="MANDIRI">MANDIRI</option>
                        <option value="BRI">BRI</option>
                        <option value="DANA">DANA</option>
                        <option value="BNI">BNI</option>
                        <option value="BCA">BCA</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Nama Rekening</label>
                    <input type="text" class="form-control" id="add-account-name" placeholder="Nama pemilik rekening">
                </div>
                <div class="form-group">
                    <label class="form-label">Nomor Rekening</label>
                    <input type="text" class="form-control" id="add-account-number" placeholder="Nomor rekening">
                </div>
                <div class="form-group">
                    <label class="form-label">Grup</label>
                    <input type="text" class="form-control" id="add-account-group" placeholder="Contoh: 1,3,5,7 atau 2,4,6,8">
                </div>
                <div class="form-group" style="text-align: right; margin-top: 20px;">
                    <button class="btn btn-primary" id="submit-add-account">
                        <i class="fas fa-save"></i> Simpan Rekening
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCYDX9-p956ZZSXsX7jzMPhUh9YF2tzGtE",
            authDomain: "geser-grup-bank-angkabet167.firebaseapp.com",
            databaseURL: "https://geser-grup-bank-angkabet167-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "geser-grup-bank-angkabet167",
            storageBucket: "geser-grup-bank-angkabet167.firebasestorage.app",
            messagingSenderId: "937479849388",
            appId: "1:937479849388:web:0c7f6f7c2feb0a3c0ae609",
            measurementId: "G-0NKQ8K1S18"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();
        const provider = new firebase.auth.GoogleAuthProvider();

        // Create stars background
        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            
            // Create twinkling stars
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.opacity = Math.random();
                star.style.setProperty('--duration', `${5 + Math.random() * 10}s`);
                starsContainer.appendChild(star);
            }
            
            // Create falling stars
            for (let i = 0; i < 5; i++) {
                const fallingStar = document.createElement('div');
                fallingStar.className = 'falling-star';
                fallingStar.style.left = `${Math.random() * 100}%`;
                fallingStar.style.top = `${Math.random() * 100}%`;
                fallingStar.style.setProperty('--fall-duration', `${5 + Math.random() * 10}s`);
                starsContainer.appendChild(fallingStar);
                
                // Random delay for falling stars
                fallingStar.style.animationDelay = `${Math.random() * 10}s`;
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            createStars();
            
            // Check auth state
            auth.onAuthStateChanged(user => {
                if (user) {
                    // User is signed in
                    showDashboard(user);
                    setupDatabaseListeners(user);
                } else {
                    // User is signed out
                    showLoginPage();
                }
            });
            
            // Setup login button
            document.getElementById('google-login').addEventListener('click', () => {
                auth.signInWithPopup(provider).catch(error => {
                    document.getElementById('login-error').textContent = error.message;
                    document.getElementById('login-error').style.display = 'block';
                });
            });
            
            // Setup logout button
            document.getElementById('logout-btn').addEventListener('click', () => {
                auth.signOut();
            });
            
            // Setup tab navigation
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active class from all tabs
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    tab.classList.add('active');
                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Setup form submissions
            document.getElementById('submit-geser').addEventListener('click', submitGeserG);
            document.getElementById('submit-tambah').addEventListener('click', submitTambahG);
            document.getElementById('check-group').addEventListener('click', checkGroup);
            document.getElementById('add-account-btn').addEventListener('click', showAddAccountModal);
            document.getElementById('close-add-account').addEventListener('click', hideAddAccountModal);
            document.getElementById('submit-add-account').addEventListener('click', submitAddAccount);
            
            // Setup refresh buttons
            document.getElementById('refresh-waiting').addEventListener('click', refreshWaiting);
            document.getElementById('refresh-activity').addEventListener('click', refreshActivity);
            document.getElementById('refresh-logs').addEventListener('click', refreshLogs);
            
            // Setup history filter
            document.getElementById('history-filter').addEventListener('change', refreshHistory);
        });

        // Show login page
        function showLoginPage() {
            document.getElementById('login-page').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
        }

        // Show dashboard
        function showDashboard(user) {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Set user info
            document.getElementById('user-name').textContent = user.displayName || user.email;
            document.getElementById('user-avatar').textContent = user.displayName ? user.displayName.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase();
            
            // Load initial data
            refreshWaiting();
            refreshActivity();
            refreshHistory();
            refreshAccounts();
            refreshLogs();
            updateStats();
        }

        // Setup database listeners
        function setupDatabaseListeners(user) {
            // Listen for waiting transactions count
            database.ref('waiting').on('value', snapshot => {
                const count = snapshot.numChildren();
                document.getElementById('waiting-badge').textContent = count;
                document.getElementById('waiting-today').textContent = count;
            });
            
            // Listen for geserG count today
            const today = new Date().toISOString().split('T')[0];
            database.ref('history').orderByChild('date').equalTo(today).on('value', snapshot => {
                let geserCount = 0;
                let tambahCount = 0;
                
                snapshot.forEach(child => {
                    if (child.val().type === 'geser') {
                        geserCount++;
                    } else if (child.val().type === 'tambah') {
                        tambahCount++;
                    }
                });
                
                document.getElementById('geser-today').textContent = geserCount;
                document.getElementById('tambah-today').textContent = tambahCount;
            });
            
            // Listen for online users
            const userStatusRef = database.ref('status/' + user.uid);
            const usersRef = database.ref('users');
            
            // Set user status to online
            userStatusRef.set({
                status: 'online',
                lastChanged: firebase.database.ServerValue.TIMESTAMP,
                name: user.displayName || user.email
            });
            
            // Set user status to offline when disconnected
            userStatusRef.onDisconnect().set({
                status: 'offline',
                lastChanged: firebase.database.ServerValue.TIMESTAMP,
                name: user.displayName || user.email
            });
            
            // Listen for online users
            database.ref('status').on('value', snapshot => {
                const users = [];
                snapshot.forEach(child => {
                    users.push({
                        id: child.key,
                        ...child.val()
                    });
                });
                
                displayOnlineUsers(users);
            });
        }

        // Display online users
        function displayOnlineUsers(users) {
            const onlineUsersContainer = document.getElementById('online-users');
            onlineUsersContainer.innerHTML = '';
            
            if (users.length === 0) {
                onlineUsersContainer.innerHTML = '<p>Tidak ada pengguna online</p>';
                return;
            }
            
            users.forEach(user => {
                const userElement = document.createElement('div');
                userElement.style.display = 'flex';
                userElement.style.alignItems = 'center';
                userElement.style.marginBottom = '10px';
                
                const avatar = document.createElement('div');
                avatar.className = 'user-avatar';
                avatar.textContent = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                avatar.style.marginRight = '10px';
                
                const info = document.createElement('div');
                info.style.flex = '1';
                
                const name = document.createElement('div');
                name.textContent = user.name || 'Unknown User';
                name.style.fontWeight = '500';
                
                const status = document.createElement('div');
                status.style.fontSize = '12px';
                status.style.color = user.status === 'online' ? '#28A745' : '#DC3545';
                
                if (user.status === 'online') {
                    status.textContent = 'Online';
                    if (user.lastChanged) {
                        status.textContent += ' (Aktif sekarang)';
                    }
                } else {
                    status.textContent = 'Offline';
                    if (user.lastChanged) {
                        const lastActive = new Date(user.lastChanged);
                        status.textContent += ` (Terakhir aktif: ${lastActive.toLocaleTimeString()})`;
                    }
                }
                
                info.appendChild(name);
                info.appendChild(status);
                
                userElement.appendChild(avatar);
                userElement.appendChild(info);
                
                onlineUsersContainer.appendChild(userElement);
            });
        }

        // Submit Geser G form
        function submitGeserG() {
            const bankLama = document.getElementById('geser-bank-lama').value;
            const namaLama = document.getElementById('geser-nama-lama').value;
            const nomorLama = document.getElementById('geser-nomor-lama').value;
            const bankBaru = document.getElementById('geser-bank-baru').value;
            const namaBaru = document.getElementById('geser-nama-baru').value;
            const nomorBaru = document.getElementById('geser-nomor-baru').value;
            
            const errorContainer = document.getElementById('geser-error');
            errorContainer.style.display = 'none';
            
            // Validate form
            if (!bankLama || !namaLama || !nomorLama || !bankBaru || !namaBaru || !nomorBaru) {
                errorContainer.textContent = 'Semua field harus diisi!';
                errorContainer.style.display = 'block';
                return;
            }
            
            // Check if account exists (in a real app, you would verify with your database)
            // For now, we'll just proceed
            
            // Create transaction in waiting
            const user = auth.currentUser;
            const transactionId = database.ref().child('waiting').push().key;
            const transactionData = {
                type: 'geser',
                from: {
                    bank: bankLama,
                    name: namaLama,
                    number: nomorLama
                },
                to: {
                    bank: bankBaru,
                    name: namaBaru,
                    number: nomorBaru
                },
                submittedBy: {
                    uid: user.uid,
                    name: user.displayName || user.email,
                    email: user.email
                },
                submittedAt: firebase.database.ServerValue.TIMESTAMP,
                status: 'pending'
            };
            
            // Add to waiting list
            database.ref('waiting/' + transactionId).set(transactionData)
                .then(() => {
                    // Show success message
                    const successContainer = document.getElementById('geser-success');
                    successContainer.innerHTML = '<i class="fas fa-check-circle"></i> Permintaan geser G berhasil diajukan dan menunggu persetujuan!';
                    successContainer.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('geser-bank-lama').value = '';
                    document.getElementById('geser-nama-lama').value = '';
                    document.getElementById('geser-nomor-lama').value = '';
                    document.getElementById('geser-bank-baru').value = '';
                    document.getElementById('geser-nama-baru').value = '';
                    document.getElementById('geser-nomor-baru').value = '';
                    
                    // Hide success message after 5 seconds
                    setTimeout(() => {
                        successContainer.style.display = 'none';
                    }, 5000);
                    
                    // Add to logs
                    addLog(`Mengajukan permintaan geser G dari ${bankLama} ${nomorLama} ke ${bankBaru} ${nomorBaru}`);
                    
                    // Refresh waiting list
                    refreshWaiting();
                })
                .catch(error => {
                    errorContainer.textContent = error.message;
                    errorContainer.style.display = 'block';
                });
        }

        // Submit Tambah G form
        function submitTambahG() {
            const bank = document.getElementById('tambah-bank').value;
            const nama = document.getElementById('tambah-nama').value;
            const nomor = document.getElementById('tambah-nomor').value;
            
            const errorContainer = document.getElementById('tambah-error');
            errorContainer.style.display = 'none';
            
            // Validate form
            if (!bank || !nama || !nomor) {
                errorContainer.textContent = 'Semua field harus diisi!';
                errorContainer.style.display = 'block';
                return;
            }
            
            // Create transaction in waiting
            const user = auth.currentUser;
            const transactionId = database.ref().child('waiting').push().key;
            const transactionData = {
                type: 'tambah',
                account: {
                    bank: bank,
                    name: nama,
                    number: nomor
                },
                submittedBy: {
                    uid: user.uid,
                    name: user.displayName || user.email,
                    email: user.email
                },
                submittedAt: firebase.database.ServerValue.TIMESTAMP,
                status: 'pending'
            };
            
            // Add to waiting list
            database.ref('waiting/' + transactionId).set(transactionData)
                .then(() => {
                    // Show success message
                    const successContainer = document.getElementById('tambah-success');
                    successContainer.innerHTML = '<i class="fas fa-check-circle"></i> Permintaan tambah G berhasil diajukan dan menunggu persetujuan!';
                    successContainer.style.display = 'block';
                    
                    // Clear form
                    document.getElementById('tambah-bank').value = '';
                    document.getElementById('tambah-nama').value = '';
                    document.getElementById('tambah-nomor').value = '';
                    
                    // Hide success message after 5 seconds
                    setTimeout(() => {
                        successContainer.style.display = 'none';
                    }, 5000);
                    
                    // Add to logs
                    addLog(`Mengajukan permintaan tambah G untuk ${bank} ${nomor}`);
                    
                    // Refresh waiting list
                    refreshWaiting();
                })
                .catch(error => {
                    errorContainer.textContent = error.message;
                    errorContainer.style.display = 'block';
                });
        }

        // Refresh waiting list
        function refreshWaiting() {
            const waitingList = document.getElementById('waiting-list');
            waitingList.innerHTML = '<tr><td colspan="5" style="text-align: center;"><div class="spinner"></div> Memuat data...</td></tr>';
            
            database.ref('waiting').once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        waitingList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Tidak ada data waiting approval</td></tr>';
                        return;
                    }
                    
                    waitingList.innerHTML = '';
                    
                    snapshot.forEach(child => {
                        const transaction = child.val();
                        const row = document.createElement('tr');
                        
                        // Format date
                        const date = new Date(transaction.submittedAt);
                        const dateStr = date.toLocaleString();
                        
                        // Create cells
                        const dateCell = document.createElement('td');
                        dateCell.textContent = dateStr;
                        
                        const typeCell = document.createElement('td');
                        typeCell.textContent = transaction.type === 'geser' ? 'Geser G' : 'Tambah G';
                        
                        const detailCell = document.createElement('td');
                        if (transaction.type === 'geser') {
                            detailCell.innerHTML = `
                                <strong>Dari:</strong> ${transaction.from.bank} - ${transaction.from.number}<br>
                                <strong>Ke:</strong> ${transaction.to.bank} - ${transaction.to.number}
                            `;
                        } else {
                            detailCell.innerHTML = `
                                <strong>Bank:</strong> ${transaction.account.bank}<br>
                                <strong>No Rek:</strong> ${transaction.account.number}
                            `;
                        }
                        
                        const statusCell = document.createElement('td');
                        const statusBadge = document.createElement('span');
                        statusBadge.className = 'status-badge status-pending';
                        statusBadge.textContent = 'Pending';
                        statusCell.appendChild(statusBadge);
                        
                        const actionCell = document.createElement('td');
                        const approveBtn = document.createElement('button');
                        approveBtn.className = 'btn btn-success';
                        approveBtn.innerHTML = '<i class="fas fa-check"></i> Approve';
                        approveBtn.addEventListener('click', () => approveTransaction(child.key, transaction));
                        
                        const rejectBtn = document.createElement('button');
                        rejectBtn.className = 'btn btn-danger';
                        rejectBtn.style.marginLeft = '5px';
                        rejectBtn.innerHTML = '<i class="fas fa-times"></i> Reject';
                        rejectBtn.addEventListener('click', () => rejectTransaction(child.key, transaction));
                        
                        actionCell.appendChild(approveBtn);
                        actionCell.appendChild(rejectBtn);
                        
                        // Append cells to row
                        row.appendChild(dateCell);
                        row.appendChild(typeCell);
                        row.appendChild(detailCell);
                        row.appendChild(statusCell);
                        row.appendChild(actionCell);
                        
                        // Append row to table
                        waitingList.appendChild(row);
                    });
                })
                .catch(error => {
                    waitingList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #DC3545;">Gagal memuat data: ' + error.message + '</td></tr>';
                });
        }

        // Approve transaction
        function approveTransaction(transactionId, transaction) {
            const user = auth.currentUser;
            
            // Add to history
            const historyData = {
                ...transaction,
                approvedBy: {
                    uid: user.uid,
                    name: user.displayName || user.email,
                    email: user.email
                },
                approvedAt: firebase.database.ServerValue.TIMESTAMP,
                status: 'approved',
                date: new Date().toISOString().split('T')[0] // Today's date in YYYY-MM-DD format
            };
            
            // For tambah G, also add to accounts
            if (transaction.type === 'tambah') {
                const accountId = database.ref().child('accounts').push().key;
                const accountData = {
                    bank: transaction.account.bank,
                    name: transaction.account.name,
                    number: transaction.account.number,
                    status: 'active',
                    group: '', // Will be assigned later
                    addedBy: transaction.submittedBy,
                    addedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                database.ref('accounts/' + accountId).set(accountData);
            }
            
            // For geser G, update the account in the database (in a real app)
            
            // Move to history
            database.ref('history/' + transactionId).set(historyData)
                .then(() => {
                    // Remove from waiting
                    return database.ref('waiting/' + transactionId).remove();
                })
                .then(() => {
                    // Refresh lists
                    refreshWaiting();
                    refreshHistory();
                    refreshAccounts();
                    
                    // Add to logs
                    addLog(`Menyetujui transaksi ${transaction.type} ${transactionId}`);
                    
                    // Show success message
                    alert('Transaksi berhasil disetujui!');
                })
                .catch(error => {
                    alert('Gagal menyetujui transaksi: ' + error.message);
                });
        }

        // Reject transaction
        function rejectTransaction(transactionId, transaction) {
            if (!confirm('Apakah Anda yakin ingin menolak transaksi ini?')) {
                return;
            }
            
            const user = auth.currentUser;
            
            // Add to history as rejected
            const historyData = {
                ...transaction,
                rejectedBy: {
                    uid: user.uid,
                    name: user.displayName || user.email,
                    email: user.email
                },
                rejectedAt: firebase.database.ServerValue.TIMESTAMP,
                status: 'rejected',
                date: new Date().toISOString().split('T')[0] // Today's date in YYYY-MM-DD format
            };
            
            // Move to history
            database.ref('history/' + transactionId).set(historyData)
                .then(() => {
                    // Remove from waiting
                    return database.ref('waiting/' + transactionId).remove();
                })
                .then(() => {
                    // Refresh lists
                    refreshWaiting();
                    refreshHistory();
                    
                    // Add to logs
                    addLog(`Menolak transaksi ${transaction.type} ${transactionId}`);
                    
                    // Show success message
                    alert('Transaksi berhasil ditolak!');
                })
                .catch(error => {
                    alert('Gagal menolak transaksi: ' + error.message);
                });
        }

        // Refresh history
        function refreshHistory() {
            const filter = document.getElementById('history-filter').value;
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '<tr><td colspan="5" style="text-align: center;"><div class="spinner"></div> Memuat data...</td></tr>';
            
            let query = database.ref('history').orderByChild('submittedAt');
            
            // Apply filter
            const now = new Date();
            let startDate, endDate;
            
            switch (filter) {
                case 'today':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    break;
                case 'yesterday':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                    break;
                case 'week':
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() - now.getDay());
                    endDate = new Date(now.getFullYear(), now.getMonth(), now.getDate() + (6 - now.getDay()) + 1);
                    break;
                case 'month':
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                    endDate = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                    break;
                case 'all':
                default:
                    // No date filtering
                    break;
            }
            
            if (filter !== 'all') {
                query = query.startAt(startDate.getTime()).endAt(endDate.getTime() - 1);
            }
            
            query.once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        historyList.innerHTML = '<tr><td colspan="5" style="text-align: center;">Tidak ada data history</td></tr>';
                        return;
                    }
                    
                    historyList.innerHTML = '';
                    
                    // Convert to array and sort by date (newest first)
                    const transactions = [];
                    snapshot.forEach(child => {
                        transactions.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                    
                    transactions.sort((a, b) => b.submittedAt - a.submittedAt);
                    
                    transactions.forEach(transaction => {
                        const row = document.createElement('tr');
                        
                        // Format date
                        const date = new Date(transaction.submittedAt);
                        const dateStr = date.toLocaleString();
                        
                        // Create cells
                        const dateCell = document.createElement('td');
                        dateCell.textContent = dateStr;
                        
                        const typeCell = document.createElement('td');
                        typeCell.textContent = transaction.type === 'geser' ? 'Geser G' : 'Tambah G';
                        
                        const detailCell = document.createElement('td');
                        if (transaction.type === 'geser') {
                            detailCell.innerHTML = `
                                <strong>Dari:</strong> ${transaction.from.bank} - ${transaction.from.number}<br>
                                <strong>Ke:</strong> ${transaction.to.bank} - ${transaction.to.number}
                            `;
                        } else {
                            detailCell.innerHTML = `
                                <strong>Bank:</strong> ${transaction.account.bank}<br>
                                <strong>No Rek:</strong> ${transaction.account.number}
                            `;
                        }
                        
                        const statusCell = document.createElement('td');
                        const statusBadge = document.createElement('span');
                        statusBadge.className = transaction.status === 'approved' ? 
                            'status-badge status-online' : 'status-badge status-offline';
                        statusBadge.textContent = transaction.status === 'approved' ? 'Approved' : 'Rejected';
                        statusCell.appendChild(statusBadge);
                        
                        const approvedByCell = document.createElement('td');
                        if (transaction.status === 'approved') {
                            approvedByCell.textContent = transaction.approvedBy.name;
                        } else {
                            approvedByCell.textContent = transaction.rejectedBy.name;
                        }
                        
                        // Append cells to row
                        row.appendChild(dateCell);
                        row.appendChild(typeCell);
                        row.appendChild(detailCell);
                        row.appendChild(statusCell);
                        row.appendChild(approvedByCell);
                        
                        // Append row to table
                        historyList.appendChild(row);
                    });
                })
                .catch(error => {
                    historyList.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #DC3545;">Gagal memuat data: ' + error.message + '</td></tr>';
                });
        }

        // Refresh accounts
        function refreshAccounts() {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '<tr><td colspan="6" style="text-align: center;"><div class="spinner"></div> Memuat data...</td></tr>';
            
            database.ref('accounts').once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        accountsList.innerHTML = '<tr><td colspan="6" style="text-align: center;">Tidak ada data rekening</td></tr>';
                        return;
                    }
                    
                    accountsList.innerHTML = '';
                    
                    snapshot.forEach(child => {
                        const account = child.val();
                        const row = document.createElement('tr');
                        
                        // Create cells
                        const bankCell = document.createElement('td');
                        bankCell.textContent = account.bank;
                        
                        const nameCell = document.createElement('td');
                        nameCell.textContent = account.name;
                        
                        const numberCell = document.createElement('td');
                        numberCell.textContent = account.number;
                        
                        const statusCell = document.createElement('td');
                        const statusBadge = document.createElement('span');
                        statusBadge.className = account.status === 'active' ? 
                            'status-badge status-online' : 'status-badge status-offline';
                        statusBadge.textContent = account.status === 'active' ? 'Active' : 'Inactive';
                        statusCell.appendChild(statusBadge);
                        
                        const groupCell = document.createElement('td');
                        groupCell.textContent = account.group || '-';
                        
                        const actionCell = document.createElement('td');
                        const editBtn = document.createElement('button');
                        editBtn.className = 'btn btn-secondary';
                        editBtn.style.marginRight = '5px';
                        editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                        editBtn.addEventListener('click', () => editAccount(child.key, account));
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'btn btn-danger';
                        deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                        deleteBtn.addEventListener('click', () => deleteAccount(child.key, account));
                        
                        actionCell.appendChild(editBtn);
                        actionCell.appendChild(deleteBtn);
                        
                        // Append cells to row
                        row.appendChild(bankCell);
                        row.appendChild(nameCell);
                        row.appendChild(numberCell);
                        row.appendChild(statusCell);
                        row.appendChild(groupCell);
                        row.appendChild(actionCell);
                        
                        // Append row to table
                        accountsList.appendChild(row);
                    });
                })
                .catch(error => {
                    accountsList.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #DC3545;">Gagal memuat data: ' + error.message + '</td></tr>';
                });
        }

        // Show add account modal
        function showAddAccountModal() {
            document.getElementById('add-account-modal').style.display = 'flex';
        }

        // Hide add account modal
        function hideAddAccountModal() {
            document.getElementById('add-account-modal').style.display = 'none';
            document.getElementById('add-account-error').style.display = 'none';
            document.getElementById('add-account-bank').value = '';
            document.getElementById('add-account-name').value = '';
            document.getElementById('add-account-number').value = '';
            document.getElementById('add-account-group').value = '';
        }

        // Submit add account form
        function submitAddAccount() {
            const bank = document.getElementById('add-account-bank').value;
            const name = document.getElementById('add-account-name').value;
            const number = document.getElementById('add-account-number').value;
            const group = document.getElementById('add-account-group').value;
            
            const errorContainer = document.getElementById('add-account-error');
            errorContainer.style.display = 'none';
            
            // Validate form
            if (!bank || !name || !number) {
                errorContainer.textContent = 'Bank, Nama, dan Nomor Rekening harus diisi!';
                errorContainer.style.display = 'block';
                return;
            }
            
            // Create account
            const user = auth.currentUser;
            const accountId = database.ref().child('accounts').push().key;
            const accountData = {
                bank: bank,
                name: name,
                number: number,
                group: group,
                status: 'active',
                addedBy: {
                    uid: user.uid,
                    name: user.displayName || user.email,
                    email: user.email
                },
                addedAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            // Add to accounts
            database.ref('accounts/' + accountId).set(accountData)
                .then(() => {
                    // Hide modal and refresh
                    hideAddAccountModal();
                    refreshAccounts();
                    
                    // Add to logs
                    addLog(`Menambahkan rekening baru ${bank} ${number}`);
                    
                    // Show success message
                    alert('Rekening berhasil ditambahkan!');
                })
                .catch(error => {
                    errorContainer.textContent = error.message;
                    errorContainer.style.display = 'block';
                });
        }

        // Edit account
        function editAccount(accountId, account) {
            // In a real app, you would show an edit form
            // For now, we'll just toggle the status
            const newStatus = account.status === 'active' ? 'inactive' : 'active';
            
            database.ref('accounts/' + accountId + '/status').set(newStatus)
                .then(() => {
                    refreshAccounts();
                    addLog(`Mengubah status rekening ${account.bank} ${account.number} menjadi ${newStatus}`);
                })
                .catch(error => {
                    alert('Gagal mengubah status: ' + error.message);
                });
        }

        // Delete account
        function deleteAccount(accountId, account) {
            if (!confirm(`Apakah Anda yakin ingin menghapus rekening ${account.bank} ${account.number}?`)) {
                return;
            }
            
            database.ref('accounts/' + accountId).remove()
                .then(() => {
                    refreshAccounts();
                    addLog(`Menghapus rekening ${account.bank} ${account.number}`);
                    alert('Rekening berhasil dihapus!');
                })
                .catch(error => {
                    alert('Gagal menghapus rekening: ' + error.message);
                });
        }

        // Check group
        function checkGroup() {
            const bank = document.getElementById('group-bank').value;
            
            if (!bank) {
                alert('Pilih bank terlebih dahulu!');
                return;
            }
            
            const groupResult = document.getElementById('group-result');
            const groupList = document.getElementById('group-list');
            const groupSuccess = document.getElementById('group-success');
            const groupError = document.getElementById('group-error');
            
            groupResult.style.display = 'block';
            groupList.innerHTML = '<tr><td colspan="6" style="text-align: center;"><div class="spinner"></div> Memeriksa grup...</td></tr>';
            groupSuccess.style.display = 'none';
            groupError.style.display = 'none';
            
            // In a real app, you would check the actual groups in your database
            // For now, we'll simulate checking groups
            
            // Simulate API call
            setTimeout(() => {
                // This is just sample data - in a real app, you would query your database
                const sampleData = [
                    {
                        no: 1,
                        bank: 'BCA',
                        name: 'AMELIA PRASASTI NINGSIH',
                        number: '4660366887',
                        status: 'Online',
                        group: '19,17,15,13,11,9,7,5,3,1'
                    },
                    {
                        no: 2,
                        bank: 'BCA',
                        name: 'Heri purnomo',
                        number: '3860228318',
                        status: 'Online',
                        group: '20,18,16,14,12,10,8,6,4,2'
                    },
                    {
                        no: 3,
                        bank: 'BCA',
                        name: 'Muhammad Yusuf Alan Permana',
                        number: '0613865851',
                        status: 'Online',
                        group: '-'
                    }
                ];
                
                // Filter by selected bank
                const filteredData = sampleData.filter(item => item.bank === bank);
                
                if (filteredData.length === 0) {
                    groupList.innerHTML = '<tr><td colspan="6" style="text-align: center;">Tidak ada data untuk bank ini</td></tr>';
                    return;
                }
                
                groupList.innerHTML = '';
                
                filteredData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // Create cells
                    const noCell = document.createElement('td');
                    noCell.textContent = item.no;
                    
                    const bankCell = document.createElement('td');
                    bankCell.textContent = item.bank;
                    
                    const nameCell = document.createElement('td');
                    nameCell.textContent = item.name;
                    
                    const numberCell = document.createElement('td');
                    numberCell.textContent = item.number;
                    
                    const statusCell = document.createElement('td');
                    const statusBadge = document.createElement('span');
                    statusBadge.className = 'status-badge status-online';
                    statusBadge.textContent = item.status;
                    statusCell.appendChild(statusBadge);
                    
                    const groupCell = document.createElement('td');
                    groupCell.textContent = item.group;
                    
                    // Append cells to row
                    row.appendChild(noCell);
                    row.appendChild(bankCell);
                    row.appendChild(nameCell);
                    row.appendChild(numberCell);
                    row.appendChild(statusCell);
                    row.appendChild(groupCell);
                    
                    // Append row to table
                    groupList.appendChild(row);
                });
                
                // Check if all groups are complete (this is just a simulation)
                const hasCompleteGroups = filteredData.some(item => item.group.includes('20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1'));
                
                if (hasCompleteGroups) {
                    groupSuccess.style.display = 'block';
                } else {
                    groupError.style.display = 'block';
                    groupError.innerHTML += '<ul style="margin-top: 10px; margin-bottom: 0;">';
                    
                    // Check for missing groups (simulated)
                    const missingGroups = [];
                    for (let i = 1; i <= 20; i++) {
                        const hasGroup = filteredData.some(item => item.group.includes(i.toString()));
                        if (!hasGroup) {
                            missingGroups.push(i);
                        }
                    }
                    
                    if (missingGroups.length > 0) {
                        groupError.innerHTML += `<li>Grup yang hilang: ${missingGroups.join(', ')}</li>`;
                    }
                    
                    // Check for duplicate groups (simulated)
                    const allGroups = [];
                    filteredData.forEach(item => {
                        if (item.group && item.group !== '-') {
                            item.group.split(',').forEach(g => {
                                allGroups.push(g.trim());
                            });
                        }
                    });
                    
                    const duplicateGroups = [];
                    const groupCount = {};
                    allGroups.forEach(g => {
                        groupCount[g] = (groupCount[g] || 0) + 1;
                    });
                    
                    for (const g in groupCount) {
                        if (groupCount[g] > 1) {
                            duplicateGroups.push(g);
                        }
                    }
                    
                    if (duplicateGroups.length > 0) {
                        groupError.innerHTML += `<li>Grup yang double: ${duplicateGroups.join(', ')}</li>`;
                    }
                    
                    groupError.innerHTML += '</ul>';
                }
            }, 1000);
        }

        // Refresh activity
        function refreshActivity() {
            const activityContainer = document.getElementById('recent-activity');
            activityContainer.innerHTML = '<div class="timeline-item"><div class="timeline-date">Loading...</div><div class="timeline-content"><div class="spinner"></div> Memuat aktivitas...</div></div>';
            
            database.ref('history').orderByChild('submittedAt').limitToLast(5).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        activityContainer.innerHTML = '<div class="timeline-item"><div class="timeline-content">Tidak ada aktivitas terakhir</div></div>';
                        return;
                    }
                    
                    activityContainer.innerHTML = '';
                    
                    // Convert to array and sort by date (newest first)
                    const activities = [];
                    snapshot.forEach(child => {
                        activities.push(child.val());
                    });
                    
                    activities.sort((a, b) => b.submittedAt - a.submittedAt);
                    
                    activities.forEach(activity => {
                        const date = new Date(activity.submittedAt);
                        const dateStr = date.toLocaleString();
                        
                        const item = document.createElement('div');
                        item.className = 'timeline-item';
                        
                        const dateEl = document.createElement('div');
                        dateEl.className = 'timeline-date';
                        dateEl.textContent = dateStr;
                        
                        const content = document.createElement('div');
                        content.className = 'timeline-content';
                        
                        let actionText = '';
                        if (activity.type === 'geser') {
                            actionText = `Geser G dari ${activity.from.bank} (${activity.from.number}) ke ${activity.to.bank} (${activity.to.number})`;
                        } else {
                            actionText = `Tambah G untuk ${activity.account.bank} (${activity.account.number})`;
                        }
                        
                        const status = activity.status === 'approved' ? 'Disetujui' : 'Ditolak';
                        
                        content.innerHTML = `
                            <strong>${activity.submittedBy.name}</strong> ${actionText}<br>
                            Status: <span class="${activity.status === 'approved' ? 'status-online' : 'status-offline'}">${status}</span>
                        `;
                        
                        item.appendChild(dateEl);
                        item.appendChild(content);
                        activityContainer.appendChild(item);
                    });
                })
                .catch(error => {
                    activityContainer.innerHTML = '<div class="timeline-item"><div class="timeline-content" style="color: #DC3545;">Gagal memuat aktivitas: ' + error.message + '</div></div>';
                });
        }

        // Refresh logs
        function refreshLogs() {
            const logsList = document.getElementById('logs-list');
            logsList.innerHTML = '<tr><td colspan="4" style="text-align: center;"><div class="spinner"></div> Memuat data...</td></tr>';
            
            database.ref('logs').orderByChild('timestamp').limitToLast(50).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        logsList.innerHTML = '<tr><td colspan="4" style="text-align: center;">Tidak ada log aktivitas</td></tr>';
                        return;
                    }
                    
                    logsList.innerHTML = '';
                    
                    // Convert to array and sort by timestamp (newest first)
                    const logs = [];
                    snapshot.forEach(child => {
                        logs.push(child.val());
                    });
                    
                    logs.sort((a, b) => b.timestamp - a.timestamp);
                    
                    logs.forEach(log => {
                        const row = document.createElement('tr');
                        
                        // Format date
                        const date = new Date(log.timestamp);
                        const dateStr = date.toLocaleString();
                        
                        // Create cells
                        const dateCell = document.createElement('td');
                        dateCell.textContent = dateStr;
                        
                        const userCell = document.createElement('td');
                        userCell.textContent = log.user;
                        
                        const actionCell = document.createElement('td');
                        actionCell.textContent = log.action;
                        
                        const detailCell = document.createElement('td');
                        detailCell.textContent = log.details || '-';
                        
                        // Append cells to row
                        row.appendChild(dateCell);
                        row.appendChild(userCell);
                        row.appendChild(actionCell);
                        row.appendChild(detailCell);
                        
                        // Append row to table
                        logsList.appendChild(row);
                    });
                })
                .catch(error => {
                    logsList.innerHTML = '<tr><td colspan="4" style="text-align: center; color: #DC3545;">Gagal memuat log: ' + error.message + '</td></tr>';
                });
        }

        // Add log
        function addLog(action, details = '') {
            const user = auth.currentUser;
            const logData = {
                user: user.displayName || user.email,
                action: action,
                details: details,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };
            
            database.ref('logs').push(logData);
        }

        // Update stats
        function updateStats() {
            // Today's date in YYYY-MM-DD format
            const today = new Date().toISOString().split('T')[0];
            
            // Count geserG today
            database.ref('history').orderByChild('date').equalTo(today).once('value')
                .then(snapshot => {
                    let geserCount = 0;
                    let tambahCount = 0;
                    
                    snapshot.forEach(child => {
                        if (child.val().type === 'geser') {
                            geserCount++;
                        } else if (child.val().type === 'tambah') {
                            tambahCount++;
                        }
                    });
                    
                    document.getElementById('geser-today').textContent = geserCount;
                    document.getElementById('tambah-today').textContent = tambahCount;
                });
            
            // Count waiting
            database.ref('waiting').once('value')
                .then(snapshot => {
                    document.getElementById('waiting-today').textContent = snapshot.numChildren();
                });
        }
    </script>
</body>
</html>
